<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Processo Ágil: pleshw</title>
  <link rel="stylesheet" href="index.css">
</head>

<body>
  <main>
    <section class="scene text-white bg-dark">
      <h5>Cena 1</h5>
    </section>
    <section class="scene text-white bg-success">
      <h5>Cena 2</h5>
    </section>
    <section class="scene text-white bg-danger">
      <h5>Cena 3</h5>
    </section>
    <section class="scene text-white bg-info">
      <h5>Cena 4</h5>
    </section>
    <section class="scene text-white bg-warning">
      <h5>Cena 5</h5>
    </section>
    <section class="scene text-white bg-primary">
      <h5>Cena 6</h5>
    </section>
    <section class="scene text-white bg-primary">
      <h5>Cena 7</h5>
    </section>
    <section class="scene text-white bg-primary">
      <h5>Cena 8</h5>
    </section>
    <section class="scene text-white bg-primary">
      <h5>Cena 9</h5>
    </section>
    <section class="scene text-white bg-primary">
      <h5>Cena 10</h5>
    </section>
    <section class="scene text-white bg-primary">
      <h5>Cena 11</h5>
    </section>

    <div class="progress"></div>
  </main>

  <!-- JavaScript Bundle with Popper -->
  <script defer src="build/anime.min.js"></script>
  <script defer src="build/typed.min.js"></script>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://unpkg.com/topojson@3"></script>
  <script defer src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script defer src="//cdnjs.cloudflare.com/ajax/libs/velocity/1.2.3/velocity.min.js"></script>
  <script defer src="//cdnjs.cloudflare.com/ajax/libs/gsap/3.8.0/gsap.min.js"></script>
  <script defer src="//cdnjs.cloudflare.com/ajax/libs/ScrollMagic/2.0.7/ScrollMagic.min.js"></script>
  <script defer src="//cdnjs.cloudflare.com/ajax/libs/ScrollMagic/2.0.7/plugins/animation.gsap.js"></script>
  <script defer src="//cdnjs.cloudflare.com/ajax/libs/ScrollMagic/2.0.7/plugins/animation.velocity.js"></script>
  <script defer src="//cdnjs.cloudflare.com/ajax/libs/ScrollMagic/2.0.7/plugins/debug.addIndicators.min.js"></script>


  <script type="module" src="build/utils.js"></script>
  <script type="module" src="build/CSSAttributes.js"></script>
  <script type="module" src="build/CSSEditor.js"></script>
  <script type="module">
    import { CSSAttributes } from './build/CSSAttributes.js';
    import { CSSEditor } from './build/CSSEditor.js';
    import { SceneScaffold } from './build/Scene/SceneScaffold.js';
    import { Scene } from './build/Scene/Scene.js';
    import { SceneView } from './build/Scene/SceneView.js';
    import { throttle, animacaoBarraProgresso } from './build/utils.js';

    window.addEventListener('load', () => {

      const scrollMagicIndicatorsController = new ScrollMagic.Controller({ addIndicators: true });

      document.querySelectorAll('.scene').forEach((item, index) => {
        const _tmpSceneScaffold = new SceneScaffold(item);
        SceneView.scenes.push(new Scene(_tmpSceneScaffold));

        SceneView.last().scrollMagicScene = new ScrollMagic.Scene({ triggerElement: SceneView.last().scaffold.element, duration: SceneView.last().scaffold.element.clientHeight })
          .setTween(SceneView.last().scaffold.element, 0.5, { backgroundColor: "red" })
          .addIndicators() // add indicators (requires plugin)
          .addTo(scrollMagicIndicatorsController)
          .on('enter', () => {
            console.log('Você entrou na cena ' + SceneView.last().id)
          });
      })

      SceneView.createControllers();

      const progressDivCss = new CSSAttributes({
        width: `100%`,
        height: `10px`,
        position: 'fixed',
        isGradient: true,
        gradientRotation: '230deg',
        transition: 'all .3s',
        x: `0px`,
        top: `calc(100% - 10px)`,
        isProgressBar: true,
        progressRotation: '90deg',
        progress: 0,
        progressColor: 'darkblue',
        progressBackground: 'transparent'
      });

      document.getElementById('prevScene').addEventListener('click', evt => {
        SceneView.prev();
      })


      document.getElementById('nextScene').addEventListener('click', evt => {
        SceneView.next();
      })

      const progressBar = document.querySelector('.progress');

      CSSEditor.from(progressBar, progressDivCss)

      window.addEventListener('scroll', function () {
        throttle(() => {
          const posicaoDestino = (this.scrollY / (document.body.scrollHeight - window.innerHeight)) * 100;
          animacaoBarraProgresso(progressBar, progressDivCss, posicaoDestino, 'scrollProgress')
        }, 100, 'scrollProgress')
      })

    })
  </script>
</body>

</html>